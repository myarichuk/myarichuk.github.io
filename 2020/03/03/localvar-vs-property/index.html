<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Local variables vs properties. No suprises here? | Graymatter Developer</title><meta name="author" content="Michael Yarichuk"><meta name="copyright" content="Michael Yarichuk"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Can the benchmark that compares array iteration vs. pointer based iteration be optimized further? Yep!In a post I wrote earlier about performance comparison between array access with pointers and the">
<meta property="og:type" content="article">
<meta property="og:title" content="Local variables vs properties. No suprises here?">
<meta property="og:url" content="https://myarichuk.github.io/repository/2020/03/03/localvar-vs-property/index.html">
<meta property="og:site_name" content="Graymatter Developer">
<meta property="og:description" content="Can the benchmark that compares array iteration vs. pointer based iteration be optimized further? Yep!In a post I wrote earlier about performance comparison between array access with pointers and the">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://myarichuk.github.io/repository/2020/03/03/localvar-vs-property/code_analysis.jpg">
<meta property="article:published_time" content="2020-03-03T18:02:14.000Z">
<meta property="article:modified_time" content="2020-03-03T18:02:14.000Z">
<meta property="article:author" content="Michael Yarichuk">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="Performance">
<meta property="article:tag" content="Optimization">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://myarichuk.github.io/repository/2020/03/03/localvar-vs-property/code_analysis.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://myarichuk.github.io/repository/2020/03/03/localvar-vs-property/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-125949801-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-125949801-1');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Local variables vs properties. No suprises here?',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2020-03-03 18:02:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Graymatter Developer" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://avatars.githubusercontent.com/u/1473701" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tag"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-envelope-open"></i><span> Contact</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2020/02/17/data-locality/benchmarkdotnet.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Graymatter Developer"><span class="site-name">Graymatter Developer</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tag"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-envelope-open"></i><span> Contact</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Local variables vs properties. No suprises here?</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-03-03T18:02:14.000Z" title="Created 2020-03-03 18:02:14">2020-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-03-03T18:02:14.000Z" title="Updated 2020-03-03 18:02:14">2020-03-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Programming/">Programming</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Programming/C/">C++</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Local variables vs properties. No suprises here?"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Can the benchmark that compares array iteration vs. pointer based iteration be optimized further? Yep!<br>In a post I wrote earlier about <a target="_blank" rel="noopener" href="http://www.graymatterdeveloper.com/2020/02/23/arrays-vs-pointers/">performance comparison between array access with pointers and the usual C#’s  way</a>, I saw an interesting comment that suggested a way to squeeze some more performance out of the scenario.<br>Using a local variable instead of a call to a property (which is in fact a method call) made sense, though I wondered, just how <em>much</em> of a performance boost it would provide.<br>So I decided to test it. The results turned out to be very… interesting. But before taking a look at the results, here is the test code: </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Params(512, 1024, 4 * 1024, 8 * 1024, 16 * 1024, 32 * 1024, 64 * 1024)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Size &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">long</span>[] Array;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">IterationSetup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>()</span> =&gt; Array = <span class="keyword">new</span> <span class="built_in">long</span>[Size];</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MethodImpl(MethodImplOptions.NoInlining)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetSize</span>()</span> =&gt; Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">//new test method</span></span><br><span class="line">    [<span class="meta">Benchmark(Baseline = true)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">IterateArrayWithLocalVar</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> size = Size;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            Array[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">IterateArray</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; Size; i++)</span><br><span class="line">            Array[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">IterateArrayWithBoundaryChecks</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//try and fool the JIT into NOT removing array boundary checks</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; GetSize(); i++)</span><br><span class="line">            Array[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">unsafe</span> <span class="keyword">void</span> <span class="title">IterateArrayWithPtr</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">fixed</span> (<span class="built_in">long</span>* ptr = Array)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; Size; i++)</span><br><span class="line">                *(ptr + i) = i; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new test method</span></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">unsafe</span> <span class="keyword">void</span> <span class="title">IterateArrayWithPtrLocalVar</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">fixed</span> (<span class="built_in">long</span>* ptr = Array)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> size = Size;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; size; i++) </span><br><span class="line">                *(ptr + i) = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> =&gt; BenchmarkRunner.Run&lt;Program&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are the results of the test:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Size</th>
<th align="right">Mean</th>
<th align="right">Error</th>
<th align="right">StdDev</th>
<th align="right">Median</th>
<th align="right">Ratio</th>
<th align="right">RatioSD</th>
</tr>
</thead>
<tbody><tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>256</strong></td>
<td align="right"><strong>215.6 ns</strong></td>
<td align="right"><strong>30.72 ns</strong></td>
<td align="right"><strong>88.65 ns</strong></td>
<td align="right"><strong>200.0 ns</strong></td>
<td align="right"><strong>?</strong></td>
<td align="right"><strong>?</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>256</td>
<td align="right">200.0 ns</td>
<td align="right">0.00 ns</td>
<td align="right">0.00 ns</td>
<td align="right">200.0 ns</td>
<td align="right">?</td>
<td align="right">?</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>256</td>
<td align="right">1,081.2 ns</td>
<td align="right">26.49 ns</td>
<td align="right">61.40 ns</td>
<td align="right">1,050.0 ns</td>
<td align="right">?</td>
<td align="right">?</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>256</td>
<td align="right">243.3 ns</td>
<td align="right">23.29 ns</td>
<td align="right">67.56 ns</td>
<td align="right">200.0 ns</td>
<td align="right">?</td>
<td align="right">?</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>256</td>
<td align="right">214.3 ns</td>
<td align="right">20.88 ns</td>
<td align="right">60.92 ns</td>
<td align="right">200.0 ns</td>
<td align="right">?</td>
<td align="right">?</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>512</strong></td>
<td align="right"><strong>272.8 ns</strong></td>
<td align="right"><strong>16.99 ns</strong></td>
<td align="right"><strong>44.76 ns</strong></td>
<td align="right"><strong>300.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>512</td>
<td align="right">342.6 ns</td>
<td align="right">21.50 ns</td>
<td align="right">61.33 ns</td>
<td align="right">300.0 ns</td>
<td align="right">1.32</td>
<td align="right">0.37</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>512</td>
<td align="right">4,942.9 ns</td>
<td align="right">96.07 ns</td>
<td align="right">85.16 ns</td>
<td align="right">4,950.0 ns</td>
<td align="right">19.43</td>
<td align="right">4.17</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>512</td>
<td align="right">372.8 ns</td>
<td align="right">20.43 ns</td>
<td align="right">57.61 ns</td>
<td align="right">400.0 ns</td>
<td align="right">1.42</td>
<td align="right">0.37</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>512</td>
<td align="right">367.7 ns</td>
<td align="right">22.20 ns</td>
<td align="right">64.06 ns</td>
<td align="right">400.0 ns</td>
<td align="right">1.40</td>
<td align="right">0.38</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>1024</strong></td>
<td align="right"><strong>558.3 ns</strong></td>
<td align="right"><strong>22.30 ns</strong></td>
<td align="right"><strong>64.35 ns</strong></td>
<td align="right"><strong>600.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>1024</td>
<td align="right">578.2 ns</td>
<td align="right">16.10 ns</td>
<td align="right">41.55 ns</td>
<td align="right">600.0 ns</td>
<td align="right">1.05</td>
<td align="right">0.14</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>1024</td>
<td align="right">4,037.5 ns</td>
<td align="right">84.28 ns</td>
<td align="right">109.59 ns</td>
<td align="right">4,000.0 ns</td>
<td align="right">7.36</td>
<td align="right">0.79</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>1024</td>
<td align="right">313.6 ns</td>
<td align="right">27.62 ns</td>
<td align="right">76.08 ns</td>
<td align="right">300.0 ns</td>
<td align="right">0.57</td>
<td align="right">0.16</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>1024</td>
<td align="right">667.1 ns</td>
<td align="right">18.58 ns</td>
<td align="right">47.30 ns</td>
<td align="right">700.0 ns</td>
<td align="right">1.21</td>
<td align="right">0.16</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>4096</strong></td>
<td align="right"><strong>2,118.9 ns</strong></td>
<td align="right"><strong>45.70 ns</strong></td>
<td align="right"><strong>77.60 ns</strong></td>
<td align="right"><strong>2,100.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>4096</td>
<td align="right">1,935.2 ns</td>
<td align="right">51.41 ns</td>
<td align="right">108.43 ns</td>
<td align="right">1,900.0 ns</td>
<td align="right">0.91</td>
<td align="right">0.08</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>4096</td>
<td align="right">15,557.1 ns</td>
<td align="right">308.82 ns</td>
<td align="right">273.76 ns</td>
<td align="right">15,400.0 ns</td>
<td align="right">7.27</td>
<td align="right">0.31</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>4096</td>
<td align="right">2,475.7 ns</td>
<td align="right">52.68 ns</td>
<td align="right">89.46 ns</td>
<td align="right">2,500.0 ns</td>
<td align="right">1.17</td>
<td align="right">0.05</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>4096</td>
<td align="right">2,413.8 ns</td>
<td align="right">53.86 ns</td>
<td align="right">78.94 ns</td>
<td align="right">2,400.0 ns</td>
<td align="right">1.14</td>
<td align="right">0.06</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>8192</strong></td>
<td align="right"><strong>4,050.0 ns</strong></td>
<td align="right"><strong>84.81 ns</strong></td>
<td align="right"><strong>90.75 ns</strong></td>
<td align="right"><strong>4,050.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>8192</td>
<td align="right">9,935.7 ns</td>
<td align="right">152.36 ns</td>
<td align="right">135.06 ns</td>
<td align="right">9,950.0 ns</td>
<td align="right">2.46</td>
<td align="right">0.08</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>8192</td>
<td align="right">33,253.3 ns</td>
<td align="right">3,421.63 ns</td>
<td align="right">5,121.34 ns</td>
<td align="right">31,250.0 ns</td>
<td align="right">8.25</td>
<td align="right">1.28</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>8192</td>
<td align="right">4,780.8 ns</td>
<td align="right">75.50 ns</td>
<td align="right">63.04 ns</td>
<td align="right">4,750.0 ns</td>
<td align="right">1.18</td>
<td align="right">0.04</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>8192</td>
<td align="right">4,813.6 ns</td>
<td align="right">101.79 ns</td>
<td align="right">191.19 ns</td>
<td align="right">4,800.0 ns</td>
<td align="right">1.18</td>
<td align="right">0.06</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>16384</strong></td>
<td align="right"><strong>8,158.3 ns</strong></td>
<td align="right"><strong>149.15 ns</strong></td>
<td align="right"><strong>116.45 ns</strong></td>
<td align="right"><strong>8,100.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>16384</td>
<td align="right">8,200.0 ns</td>
<td align="right">166.60 ns</td>
<td align="right">155.84 ns</td>
<td align="right">8,200.0 ns</td>
<td align="right">1.01</td>
<td align="right">0.02</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>16384</td>
<td align="right">69,796.8 ns</td>
<td align="right">4,058.70 ns</td>
<td align="right">11,579.70 ns</td>
<td align="right">62,650.0 ns</td>
<td align="right">8.56</td>
<td align="right">1.31</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>16384</td>
<td align="right">10,777.0 ns</td>
<td align="right">1,089.97 ns</td>
<td align="right">2,460.24 ns</td>
<td align="right">9,700.0 ns</td>
<td align="right">1.27</td>
<td align="right">0.27</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>16384</td>
<td align="right">12,319.8 ns</td>
<td align="right">1,417.59 ns</td>
<td align="right">4,090.08 ns</td>
<td align="right">9,700.0 ns</td>
<td align="right">1.49</td>
<td align="right">0.60</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>32768</strong></td>
<td align="right"><strong>16,333.3 ns</strong></td>
<td align="right"><strong>443.18 ns</strong></td>
<td align="right"><strong>527.57 ns</strong></td>
<td align="right"><strong>16,300.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>32768</td>
<td align="right">16,937.5 ns</td>
<td align="right">1,494.17 ns</td>
<td align="right">1,942.84 ns</td>
<td align="right">16,500.0 ns</td>
<td align="right">1.04</td>
<td align="right">0.13</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>32768</td>
<td align="right">187,506.0 ns</td>
<td align="right">26,906.30 ns</td>
<td align="right">79,333.84 ns</td>
<td align="right">144,100.0 ns</td>
<td align="right">19.13</td>
<td align="right">1.95</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>32768</td>
<td align="right">24,892.8 ns</td>
<td align="right">2,918.12 ns</td>
<td align="right">8,465.99 ns</td>
<td align="right">19,400.0 ns</td>
<td align="right">1.64</td>
<td align="right">0.58</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>32768</td>
<td align="right">18,850.0 ns</td>
<td align="right">338.88 ns</td>
<td align="right">264.58 ns</td>
<td align="right">18,700.0 ns</td>
<td align="right">1.15</td>
<td align="right">0.05</td>
</tr>
<tr>
<td></td>
<td></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td><strong>IterateArrayWithLocalVar</strong></td>
<td><strong>65536</strong></td>
<td align="right"><strong>83,671.0 ns</strong></td>
<td align="right"><strong>16,469.96 ns</strong></td>
<td align="right"><strong>48,562.04 ns</strong></td>
<td align="right"><strong>91,300.0 ns</strong></td>
<td align="right"><strong>1.00</strong></td>
<td align="right"><strong>0.00</strong></td>
</tr>
<tr>
<td>IterateArray</td>
<td>65536</td>
<td align="right">131,365.0 ns</td>
<td align="right">28,646.45 ns</td>
<td align="right">84,464.72 ns</td>
<td align="right">104,050.0 ns</td>
<td align="right">1.68</td>
<td align="right">0.75</td>
</tr>
<tr>
<td>IterateArrayWithBoundaryChecks</td>
<td>65536</td>
<td align="right">328,035.1 ns</td>
<td align="right">20,180.46 ns</td>
<td align="right">58,547.17 ns</td>
<td align="right">328,400.0 ns</td>
<td align="right">5.68</td>
<td align="right">3.60</td>
</tr>
<tr>
<td>IterateArrayWithPtr</td>
<td>65536</td>
<td align="right">89,072.4 ns</td>
<td align="right">17,466.58 ns</td>
<td align="right">50,950.85 ns</td>
<td align="right">75,300.0 ns</td>
<td align="right">1.16</td>
<td align="right">0.48</td>
</tr>
<tr>
<td>IterateArrayWithPtrLocalVar</td>
<td>65536</td>
<td align="right">83,553.0 ns</td>
<td align="right">15,204.40 ns</td>
<td align="right">44,830.51 ns</td>
<td align="right">96,700.0 ns</td>
<td align="right">1.08</td>
<td align="right">0.33</td>
</tr>
</tbody></table>
<p>Using a local variable for the <code>for</code> loop <em>tends</em> to be faster, but not by much. Single-digit percentages at best. But notice that it doesn’t happen in all cases. The case for 256 items is too fast for accurate measurement, so we can discard it. There is also a couple of cases where usage of local variable is less performant than using a property, which is a bit surprising and probably warrants some more investigation - I’d expect the results to be more consistent.</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C#</a><a class="post-meta__tags" href="/tags/Performance/">Performance</a><a class="post-meta__tags" href="/tags/Optimization/">Optimization</a><a class="post-meta__tags" href="/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="/2020/03/03/localvar-vs-property/code_analysis.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/07/csharp-inlining-rules/" title="Reasons for C# inlining are (a bit) more complex than you think."><img class="cover" src="/2020/03/07/csharp-inlining-rules/csharp.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Reasons for C# inlining are (a bit) more complex than you think.</div></div></a></div><div class="next-post pull-right"><a href="/2020/02/23/arrays-vs-pointers/" title="Is it faster to access arrays with pointer arithmetics?"><div class="cover" style="background: url(/2020/02/23/arrays-vs-pointers/array.svg)"></div><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Is it faster to access arrays with pointer arithmetics?</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/1473701" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Michael Yarichuk</div><div class="author-info__description">A place to share steps in my journey to become a better professional</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/myarichuk"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/myarichuk" target="_blank" title=""><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:michael.yarichuk@gmail.com" target="_blank" title=""><i class="fa fa-envelope"></i></a><a class="social-icon" href="https://twitter.com/myarichuk" target="_blank" title=""><i class="fa-brands fa-twitter"></i></a><a class="social-icon" href="https://www.linkedin.com/in/myarichuk/" target="_blank" title=""><i class="fa-brands fa-linkedin"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2020/04/25/nancyfx-vs-featherhttp/" title="NancyFx vs. FeatherHttp"><img src="/2020/04/25/nancyfx-vs-featherhttp/HTTP_logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NancyFx vs. FeatherHttp"/></a><div class="content"><a class="title" href="/2020/04/25/nancyfx-vs-featherhttp/" title="NancyFx vs. FeatherHttp">NancyFx vs. FeatherHttp</a><time datetime="2020-04-25T09:28:54.000Z" title="Created 2020-04-25 09:28:54">2020-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/04/09/fun-string-create/" title="More efficient string concatenation with string.Create()"><img src="/2020/04/09/fun-string-create/string.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="More efficient string concatenation with string.Create()"/></a><div class="content"><a class="title" href="/2020/04/09/fun-string-create/" title="More efficient string concatenation with string.Create()">More efficient string concatenation with string.Create()</a><time datetime="2020-04-09T22:17:31.000Z" title="Created 2020-04-09 22:17:31">2020-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/03/07/csharp-inlining-rules/" title="Reasons for C# inlining are (a bit) more complex than you think."><img src="/2020/03/07/csharp-inlining-rules/csharp.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Reasons for C# inlining are (a bit) more complex than you think."/></a><div class="content"><a class="title" href="/2020/03/07/csharp-inlining-rules/" title="Reasons for C# inlining are (a bit) more complex than you think.">Reasons for C# inlining are (a bit) more complex than you think.</a><time datetime="2020-03-07T15:37:36.000Z" title="Created 2020-03-07 15:37:36">2020-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/03/03/localvar-vs-property/" title="Local variables vs properties. No suprises here?"><img src="/2020/03/03/localvar-vs-property/code_analysis.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Local variables vs properties. No suprises here?"/></a><div class="content"><a class="title" href="/2020/03/03/localvar-vs-property/" title="Local variables vs properties. No suprises here?">Local variables vs properties. No suprises here?</a><time datetime="2020-03-03T18:02:14.000Z" title="Created 2020-03-03 18:02:14">2020-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/02/23/arrays-vs-pointers/" title="Is it faster to access arrays with pointer arithmetics?"><div style="background: url(/2020/02/23/arrays-vs-pointers/array.svg)"></div></a><div class="content"><a class="title" href="/2020/02/23/arrays-vs-pointers/" title="Is it faster to access arrays with pointer arithmetics?">Is it faster to access arrays with pointer arithmetics?</a><time datetime="2020-02-23T06:39:23.000Z" title="Created 2020-02-23 06:39:23">2020-02-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Michael Yarichuk</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://myarichuk.github.io/repository/2020/03/03/localvar-vs-property/'
    this.page.identifier = '/2020/03/03/localvar-vs-property/'
    this.page.title = 'Local variables vs properties. No suprises here?'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://graymatterdeveloperblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>